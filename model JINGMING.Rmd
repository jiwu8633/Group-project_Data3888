---
title: "Untitled"
output: html_document
date: "2025-04-14"
---

```{r}
library(GEOquery)
library(stringr)
library(ggplot2)
library(limma)
library(tidyverse)
library(caret)
```



```{r}
gse <- getGEO("GSE48060")

gse <- gse$GSE48060_series_matrix.txt.gz


expr_data = exprs(gse)
pheno = pData(gse)
feature = fData(gse)
```



```{r}
y <- ifelse(grepl("with recurrent events", gse$title), "Recurrent",
            ifelse(grepl("without recurrent events", gse$title), "Stable", "Control"))
```



```{r}
pheno$group <- y

design <- model.matrix(~0 + pheno$group)
colnames(design) <- c("Control", "Recurrent", "Stable")
fit <- lmFit(expr_data, design)
contrast.matrix <- makeContrasts(Control-Stable, levels=design)
fit2 <- contrasts.fit(fit, contrast.matrix)
fit2 <- eBayes(fit2)
degs <- topTable(fit2, adjust="fdr", number=Inf)
degs
```



```{r}
top_genes <- head(rownames(degs[order(abs(degs$logFC), decreasing = TRUE), ]), 20)

train_data <- t(expr_data[top_genes, ])
train_data <- as.data.frame(train_data)

colnames(train_data) <- top_genes
train_data$Group <- pheno$group

model <- train(Group ~ ., data=train_data, method="rf", trControl=trainControl(method="cv", number=5))
print(model)


test_id <- sample(1:52, 20)
test_data <- t(expr_data[top_genes, test_id])
test_data <- as.data.frame(test_data)

ewprob <- predict(model, test_data, type = "prob")
ewprob
```
